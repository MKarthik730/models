<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HeartCare Clinic – Risk & AI Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Roboto, sans-serif;
    }
    body {
      min-height: 100vh;
      background: #f3f7fb;
      color: #1f2933;
    }
    .hero {
      background: linear-gradient(135deg, #0f9cf5 0%, #047857 50%, #0ea5e9 100%);
      color: #fff;
      padding: 20px 24px 70px 24px;
    }
    .hero-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 30px;
    }
    .hero-text { flex: 1 1 320px; }
    .hero-badge {
      display: inline-block;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.25);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }
    .hero-title {
      margin-top: 10px;
      font-size: 32px;
      font-weight: 800;
      line-height: 1.2;
    }
    .hero-subtitle {
      margin-top: 8px;
      font-size: 14px;
      max-width: 460px;
      opacity: 0.9;
    }
    .hero-stats {
      margin-top: 16px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      font-size: 12px;
    }
    .hero-stat span { display: block; }
    .hero-stat .label {
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-size: 10px;
    }
    .hero-stat .value {
      font-weight: 700;
      font-size: 14px;
    }
    .hero-illustration {
      flex: 1 1 260px;
      min-width: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .heart-card {
      width: 240px;
      height: 240px;
      border-radius: 24px;
      background: radial-gradient(circle at 30% 20%, #fbbf24, #ef4444 40%, #7c3aed 80%);
      position: relative;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.45);
      overflow: hidden;
    }
    .heart-icon {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255, 255, 255, 0.9);
      font-size: 80px;
    }
    .pulse {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      border: 2px solid rgba(248, 250, 252, 0.45);
      transform: scale(0.7);
      animation: pulse 2.5s infinite;
    }
    .pulse:nth-child(2) { animation-delay: 0.5s; transform: scale(0.85); }
    .pulse:nth-child(3) { animation-delay: 1s; transform: scale(1); }
    @keyframes pulse {
      0% { opacity: 0.7; transform: scale(0.7); }
      70% { opacity: 0; transform: scale(1.25); }
      100% { opacity: 0; }
    }
    .layout {
      max-width: 1100px;
      margin: -40px auto 30px auto;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
      gap: 22px;
      padding: 0 24px 24px;
    }
    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; margin-top: -20px; }
    }
    .card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.08);
      padding: 18px 20px 20px;
      border: 1px solid #e5e7eb;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
    }
    .card-title { font-size: 16px; font-weight: 700; }
    .card-subtitle { font-size: 12px; color: #6b7280; }
    .badge-soft {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #15803d;
    }
    form { margin-top: 8px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px 14px;
    }
    @media (max-width: 700px) {
      .grid { grid-template-columns: 1fr; }
    }
    label {
      display: block;
      font-size: 12px;
      margin-bottom: 3px;
      color: #374151;
    }
    input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
      background: #f9fafb;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }
    input:focus {
      border-color: #0f9cf5;
      box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.25);
      background: #ffffff;
    }
    .actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      border: none;
      cursor: pointer;
      padding: 9px 16px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #0f9cf5 0%, #0ea5e9 40%, #22c55e 100%);
      color: white;
      box-shadow: 0 10px 22px rgba(15, 118, 110, 0.35);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.35);
    }
    .btn-ghost {
      background: #f9fafb;
      color: #4b5563;
      border: 1px solid #e5e7eb;
    }
    .btn-ghost:hover { background: #e5e7eb; }
    .card-list {
      list-style: none;
      margin-top: 8px;
      font-size: 13px;
      color: #4b5563;
    }
    .card-list li {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 6px;
    }
    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      margin-top: 4px;
      background: #0ea5e9;
    }
    .result {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #f9fafb;
      border-left: 4px solid #9ca3af;
      font-size: 13px;
    }
    .result.low {
      border-left-color: #22c55e;
      background: #ecfdf5;
    }
    .result.high {
      border-left-color: #ef4444;
      background: #fef2f2;
    }
    .result span.label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }
    .result span.value {
      display: block;
      font-weight: 700;
      font-size: 16px;
      margin-top: 2px;
    }
    #prob-bar-container {
      margin-top: 8px;
      display: none;
    }
    .prob-bar-track {
      width: 100%;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      height: 10px;
    }
    .prob-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #ef4444);
      transition: width 0.4s ease;
    }
    .footer {
      max-width: 1100px;
      margin: 0 auto 18px;
      padding: 0 24px;
      font-size: 11px;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
    }
    .footer a {
      color: #0f9cf5;
      text-decoration: none;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="hero-inner">
      <div class="hero-text">
        <div class="hero-badge">HeartCare Multispeciality Hospital</div>
        <h1 class="hero-title">Early Heart Risk Screening & Diagnostic Tests</h1>
        <p class="hero-subtitle">
          Enter clinical parameters to estimate heart disease risk using the backend model, and ask GPT for more details.
        </p>
        <div class="hero-stats">
          <div class="hero-stat">
            <span class="label">24×7 Emergency</span>
            <span class="value">Cardiac ICU</span>
          </div>
          <div class="hero-stat">
            <span class="label">Specialists</span>
            <span class="value">Interventional Cardiology</span>
          </div>
          <div class="hero-stat">
            <span class="label">Tests</span>
            <span class="value">ECG · Echo · TMT</span>
          </div>
        </div>
      </div>
      <div class="hero-illustration">
        <div class="heart-card">
          <div class="pulse"></div>
          <div class="pulse"></div>
          <div class="pulse"></div>
          <div class="heart-icon">❤️</div>
        </div>
      </div>
    </div>
  </header>

  <main class="layout">
    <!-- Risk form -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Patient Risk Assessment Form</div>
          <div class="card-subtitle">Send features to FastAPI /predict endpoint.</div>
        </div>
        <span class="badge-soft">OPD Screening</span>
      </div>

      <form id="predict-form">
        <div class="grid">
          <div>
            <label for="age">Age (years)</label>
            <input id="age" type="number" min="1" max="120" required />
          </div>
          <div>
            <label for="sex">Sex (0 = Female, 1 = Male)</label>
            <input id="sex" type="number" min="0" max="1" required />
          </div>
          <div>
            <label for="cp">Chest Pain Type (0–3)</label>
            <input id="cp" type="number" min="0" max="3" required />
          </div>
          <div>
            <label for="trestbps">Resting BP (mm Hg)</label>
            <input id="trestbps" type="number" required />
          </div>
          <div>
            <label for="chol">Cholesterol (mg/dl)</label>
            <input id="chol" type="number" required />
          </div>
          <div>
            <label for="fbs">Fasting Blood Sugar (&gt; 120 mg/dl → 1)</label>
            <input id="fbs" type="number" min="0" max="1" required />
          </div>
          <div>
            <label for="restecg">Rest ECG (0–2)</label>
            <input id="restecg" type="number" min="0" max="2" required />
          </div>
          <div>
            <label for="thalach">Max Heart Rate (thalach)</label>
            <input id="thalach" type="number" required />
          </div>
          <div>
            <label for="exang">Exercise Induced Angina (0/1)</label>
            <input id="exang" type="number" min="0" max="1" required />
          </div>
          <div>
            <label for="oldpeak">ST Depression (oldpeak)</label>
            <input id="oldpeak" type="number" step="0.1" required />
          </div>
          <div>
            <label for="slope">Slope (0–2)</label>
            <input id="slope" type="number" min="0" max="2" required />
          </div>
          <div>
            <label for="ca">No. of Vessels (0–3)</label>
            <input id="ca" type="number" min="0" max="3" required />
          </div>
          <div>
            <label for="thal">Thal (0–3)</label>
            <input id="thal" type="number" min="0" max="3" required />
          </div>
          <div>
            <label for="cp_type">Chest Pain Label (cp_type)</label>
            <input id="cp_type" type="text" placeholder="e.g. typical, atypical" required />
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">
            Predict Risk &amp; Suggest Tests
          </button>
          <button type="button" class="btn-ghost" id="clear-btn">
            Clear Form
          </button>
        </div>
      </form>
    </section>

    <!-- Result -->
    <aside class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Risk Result &amp; Suggested Tests</div>
          <div class="card-subtitle">From FastAPI /predict (RandomForest model).</div>
        </div>
      </div>

      <div id="result-box" class="result" style="display:none;">
        <span class="label">Risk Category</span>
        <span class="value" id="risk-text">–</span>
        <div id="prob-text" style="margin-top: 6px;"></div>

        <div id="prob-bar-container">
          <div style="font-size:11px; color:#6b7280; margin-bottom:3px;">Risk probability</div>
          <div class="prob-bar-track">
            <div id="prob-bar" class="prob-bar-fill"></div>
          </div>
        </div>
      </div>

      <ul class="card-list" id="tests-list">
        <li>
          <div class="dot"></div>
          <div>Resting ECG and basic vitals check for all patients.</div>
        </li>
        <li>
          <div class="dot"></div>
          <div>High‑risk: consider TMT / Stress test and 2D‑Echo.</div>
        </li>
        <li>
          <div class="dot"></div>
          <div>Very high‑risk or symptomatic: cardiology consult &amp; advanced imaging.</div>
        </li>
      </ul>
    </aside>

    <!-- GPT Assistant -->
    <section class="card" style="grid-column: 1 / -1; margin-top:10px;">
      <div class="card-header">
        <div>
          <div class="card-title">Ask GPT for Details</div>
          <div class="card-subtitle">Get more information about any heart-related topic.</div>
        </div>
      </div>

      <div>
        <label for="gpt-input">Topic or question</label>
        <input id="gpt-input" type="text" placeholder="e.g. what is chest pain type 2?" />
      </div>

      <div class="actions" style="margin-top: 10px;">
        <button type="button" class="btn-primary" id="gpt-send-btn">
          Ask GPT
        </button>
      </div>

      <div id="gpt-response" class="result" style="margin-top: 10px; display:none;">
        <span class="label">GPT Response</span>
        <span class="value" id="gpt-text">–</span>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>© 2025 HeartCare Multispeciality Hospital · Demo only.</span>
    <span>Backend: <a href="#">FastAPI + RandomForest + GPT</a></span>
  </footer>

  <script>
    const apiBase = "http://localhost:8000";

    const form = document.getElementById("predict-form");
    const clearBtn = document.getElementById("clear-btn");
    const resultBox = document.getElementById("result-box");
    const riskText = document.getElementById("risk-text");
    const probText = document.getElementById("prob-text");
    const testsList = document.getElementById("tests-list");
    const probBarContainer = document.getElementById("prob-bar-container");
    const probBar = document.getElementById("prob-bar");

    const gptInput = document.getElementById("gpt-input");
    const gptSendBtn = document.getElementById("gpt-send-btn");
    const gptResponse = document.getElementById("gpt-response");
    const gptText = document.getElementById("gpt-text");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const payload = {
        age: Number(document.getElementById("age").value),
        sex: Number(document.getElementById("sex").value),
        cp: Number(document.getElementById("cp").value),
        trestbps: Number(document.getElementById("trestbps").value),
        chol: Number(document.getElementById("chol").value),
        fbs: Number(document.getElementById("fbs").value),
        restecg: Number(document.getElementById("restecg").value),
        thalach: Number(document.getElementById("thalach").value),
        exang: Number(document.getElementById("exang").value),
        oldpeak: Number(document.getElementById("oldpeak").value),
        slope: Number(document.getElementById("slope").value),
        ca: Number(document.getElementById("ca").value),
        thal: Number(document.getElementById("thal").value),
        cp_type: document.getElementById("cp_type").value,
      };

      try {
        const res = await fetch(apiBase + "/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!res.ok) throw new Error("API error: " + res.status);

        const out = await res.json();
        const pred = out.prediction;   // 0 or 1
        const proba = out.probability; // probability for 'disease'

        const highRisk = (pred === 1);

        riskText.textContent = highRisk
          ? "High Risk of Heart Disease"
          : "Low Risk of Heart Disease";

        if (proba !== null && proba !== undefined) {
          const p = (proba * 100).toFixed(1);
          probText.textContent = "Model probability of disease: " + p + "%";

          probBarContainer.style.display = "block";
          probBar.style.width = p + "%";

          if (proba < 0.33) {
            probBar.style.background = "linear-gradient(90deg,#22c55e,#4ade80)";
          } else if (proba < 0.66) {
            probBar.style.background = "linear-gradient(90deg,#eab308,#f97316)";
          } else {
            probBar.style.background = "linear-gradient(90deg,#f97316,#ef4444)";
          }
        } else {
          probText.textContent = "Model probability not available.";
          probBarContainer.style.display = "none";
        }

        resultBox.style.display = "block";
        resultBox.classList.remove("low", "high");
        resultBox.classList.add(highRisk ? "high" : "low");

        if (highRisk) {
          testsList.innerHTML = `
            <li><div class="dot"></div><div>Immediate cardiology consultation.</div></li>
            <li><div class="dot"></div><div>ECG, 2D‑Echo, TMT / stress testing as indicated.</div></li>
            <li><div class="dot"></div><div>Blood tests: lipid profile, blood sugar, cardiac markers.</div></li>
          `;
        } else {
          testsList.innerHTML = `
            <li><div class="dot"></div><div>Routine vitals and resting ECG.</div></li>
            <li><div class="dot"></div><div>Periodic lipid profile &amp; blood sugar monitoring.</div></li>
            <li><div class="dot"></div><div>Lifestyle counselling and regular follow‑up visits.</div></li>
          `;
        }
      } catch (err) {
        riskText.textContent = "Error contacting server";
        probText.textContent = err.message;
        resultBox.style.display = "block";
        resultBox.classList.remove("low", "high");
        probBarContainer.style.display = "none";
      }
    });

    clearBtn.addEventListener("click", () => {
      form.reset();
      resultBox.style.display = "none";
      probBarContainer.style.display = "none";
      probBar.style.width = "0%";
    });

    gptSendBtn.addEventListener("click", async () => {
      const userText = gptInput.value.trim();
      if (!userText) return;

      gptText.textContent = "Thinking...";
      gptResponse.style.display = "block";

      try {
        const res = await fetch(apiBase + "/gpt", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ input: userText }),
        });

        if (!res.ok) throw new Error("API error: " + res.status);

        const out = await res.json();
        if (out.error) {
          gptText.textContent = "Error: " + out.error;
        } else {
          gptText.textContent = out.answer;
        }
      } catch (err) {
        gptText.textContent = "Error contacting GPT: " + err.message;
      }
    });
  </script>
</body>
</html>
